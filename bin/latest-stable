#!/usr/bin/env bash

set -Eeuo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Get the filter (major version) if provided
filter="${1:-}"

# Get all versions
all_versions=$("$SCRIPT_DIR/list-all")

# Filter to only stable semver versions (X.Y.Z format, no prereleases)
stable_versions=$(echo "$all_versions" | tr ' ' '\n' | grep -E '^[0-9]+\.[0-9]+\.[0-9]+$' || true)

if [[ -n $filter ]]; then
  # Filter by major version prefix
  filtered=$(echo "$stable_versions" | grep -E "^${filter}\." || true)
  # Return the last (latest) one
  echo "$filtered" | tail -1
else
  # Return the last (latest) stable version
  echo "$stable_versions" | tail -1
fi
